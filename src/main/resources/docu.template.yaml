- stage: documentation
  displayName: Documentation
  dependsOn: [ downstream ]
  condition: and(succeeded('downstream'), or(eq(variables.isDevelop, true), eq(variables.isRelease, true), eq(variables.isMaster, true)))
  jobs:
    - job: documentation
      displayName: Documentation
      pool:
        vmImage: ubuntu-latest
      steps:
        - script: |
            git clone https://$(REPO_TOKEN)@$(REPO_HOST)/$(REPO_ORGANISATION)/_git/doc-as-code
            cd doc-as-code 
            git checkout $(BRANCH_NAME)
          displayName: 'Git: checkout'
        - script: |
            mkdir -p doc-as-code/.docs/$(APP_DISPLAY_NAME)/deleteme
            rm -r doc-as-code/.docs/$(APP_DISPLAY_NAME)/*
            cp -R docs/. doc-as-code/.docs/$(APP_DISPLAY_NAME)
            mkdir -p doc-as-code/docs/$(APP_DISPLAY_NAME)/deleteme
            rm -r doc-as-code/docs/$(APP_DISPLAY_NAME)/*
            cp README.md doc-as-code/docs/$(APP_DISPLAY_NAME)/$(APP_DISPLAY_NAME).md
          displayName: 'Copy Docu'
        - script: |
            cd doc-as-code
            git config --global user.email mario.tema@ascent.io
            git config --global user.name mario.tema
            git add --all
            git status
            if [[ `git status --porcelain` ]]; then
               git commit -am "Update DOC_AS_CODE repo within docs from $(REPO_NAME) commit $(GIT_COMMIT)"
               git push https://$(REPO_TOKEN)@$(REPO_HOST)/$(REPO_ORGANISATION)/_git/doc-as-code
            fi
          displayName: 'Git: Commit'